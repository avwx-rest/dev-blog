<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="The developer blog of AVWX"><link href=http://blog.avwx.rest/2019/08-05/ rel=canonical><meta name=author content="Michael duPont"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.4.0"><title>08-05 Auth Token Rollout - AVWX Dev Blog</title><link rel=stylesheet href=../../assets/stylesheets/application.0284f74d.css><script src=../../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css></head> <body dir=ltr> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#08-05-auth-token-rollout tabindex=1 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=http://blog.avwx.rest title="AVWX Dev Blog" class="md-header-nav__button md-logo"> <i class=md-icon>flight</i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> AVWX Dev Blog </span> <span class=md-header-nav__topic> 08-05 Auth Token Rollout </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/avwx-rest/avwx-api/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> avwx-rest/avwx-api </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=http://blog.avwx.rest title="AVWX Dev Blog" class="md-nav__button md-logo"> <i class=md-icon>flight</i> </a> AVWX Dev Blog </label> <div class=md-nav__source> <a href=https://github.com/avwx-rest/avwx-api/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> avwx-rest/avwx-api </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title="Blog Home" class=md-nav__link> Blog Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> 2019 </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> 2019 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../08-04/ title="08-04 Server Migration" class=md-nav__link> 08-04 Server Migration </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 08-05 Auth Token Rollout </label> <a href=./ title="08-05 Auth Token Rollout" class="md-nav__link md-nav__link--active"> 08-05 Auth Token Rollout </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#tldr title=tl;dr class=md-nav__link> tl;dr </a> </li> <li class=md-nav__item> <a href=#problem title=Problem class=md-nav__link> Problem </a> </li> <li class=md-nav__item> <a href=#solution title=Solution class=md-nav__link> Solution </a> </li> <li class=md-nav__item> <a href=#steps-so-far title="Steps So Far" class=md-nav__link> Steps So Far </a> </li> <li class=md-nav__item> <a href=#todo title=Todo class=md-nav__link> Todo </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../08-19/ title="08-19 Stripe Checkout Migration" class=md-nav__link> 08-19 Stripe Checkout Migration </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#tldr title=tl;dr class=md-nav__link> tl;dr </a> </li> <li class=md-nav__item> <a href=#problem title=Problem class=md-nav__link> Problem </a> </li> <li class=md-nav__item> <a href=#solution title=Solution class=md-nav__link> Solution </a> </li> <li class=md-nav__item> <a href=#steps-so-far title="Steps So Far" class=md-nav__link> Steps So Far </a> </li> <li class=md-nav__item> <a href=#todo title=Todo class=md-nav__link> Todo </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/avwx-rest/avwx-api/edit/master/docs/2019/08-05.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1 id=08-05-auth-token-rollout>08-05 Auth Token Rollout</h1> <p><em>2019-08-05</em></p> <p>This is a short post detailing the rollout plan to require auth tokens in calls to AVWX.</p> <h2 id=tldr>tl;dr</h2> <ul> <li>Make a free account on the <a href=https://account.avwx.rest>account page</a></li> <li>Generate your (free) token</li> <li>Start including the header <code>Authorization: BEARER MY_TOKEN_VALUE</code></li> <li><strong>November 1st, 2019</strong>: Tokens will be required</li> <li><strong>December 1st, 2019</strong>: Daily rate limits are assigned</li> <li><strong>January 1st, 2020</strong>: Daily rate limits will be enforced</li> </ul> <h2 id=problem>Problem</h2> <p>Currently, I have no insight into how users are using the API beyond aggregate statistics and email correspondence. I would be able to </p> <p>There is also the economic issue that the API's growth has been unsustainable based on donations and feature-based offerings. About 95% of all traffic is for METARs which is a free tier feature. Introducing rate limits to tiers should help make AVWX break-even while remaining free for most users.</p> <h2 id=solution>Solution</h2> <p>API tokens will be required to call AVWX starting in November. This is to allow time to gather usage data to determine the daily rate limits for each tier. Here are the important dates:</p> <ul> <li><strong>November 1st, 2019</strong>: Tokens will be required</li> <li><strong>December 1st, 2019</strong>: Rate limits are assigned</li> <li><strong>January 1st, 2020</strong>: Rate limits will be enforced</li> </ul> <p>This should hopefully be enough time to update your apps, choose the appropriate usage tier, and register any concerns with me about this whole process. Part of the last account update included the ability to create custom tiers, so I can create custom tiers and prices for specific use cases.</p> <p>I am going to include an open-source tier. My plan as of this post is for it to contain only free tier features but have to rate limit of the lowest paid tier.</p> <p>I also plan to have rate limits for every tier. If a company is using more than the enterprise plan allows, we'll work together on a plan that fits their exact use case.</p> <p>I chose daily rate limits instead of hourly or smaller because aviation reports are requested over the course of an entire day and mostly called dawn to dusk. Hourly rate limits would restrict usage during the day and go unused at night.</p> <h2 id=steps-so-far>Steps So Far</h2> <p>I made an update to the account portal allowing users to select the free tier as an active plan and upgrade/downgrade to it as well without losing customer info. Free tiers can generate a token.</p> <p>On the API side, token validation now checks the plan associated with the token to determine fulfillment eligibility instead of merely token existance. Token-based call counting is already implemeted.</p> <h2 id=todo>Todo</h2> <p>Roughly in order:</p> <ul> <li>Divest the token auth check from specific intents via <code>endpoint.example</code> and instead use something like <code>endpoint.allowed_plans</code> to assign plans to API features.</li> <li>Generate example responses for METAR, TAF, and station endpoints</li> <li>Enforce the Authorization header for all calls</li> <li>Determine rate limits from token call usage</li> <li>Announce rate limits</li> <li>Add rate limits to plan data</li> <li>Enforce daily rate limits against token call counts</li> </ul> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../08-04/ title="08-04 Server Migration" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> 08-04 Server Migration </span> </div> </a> <a href=../08-19/ title="08-19 Stripe Checkout Migration" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Next </span> 08-19 Stripe Checkout Migration </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../assets/fonts/font-awesome.css> <a href=https://github.com/avwx-rest class="md-footer-social__link fa fa-github"></a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.245445c6.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> </body> </html>